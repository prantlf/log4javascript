<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
	<head>
		<title>log4javascript demo</title>
		<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
		<meta name="author" content="Tim Down - tim@timdown.co.uk" />
		<meta name="description" content="log4javascript, a logging framework for JavaScript based on log4j" />
		<meta name="robots" content="all" />
		<link rel="stylesheet" type="text/css" media="screen,print" href="../main.css" title="Default" />
		<script type="text/javascript" src="../log4javascript.js"></script>
		<script type="text/javascript">
			// <![CDATA[
			var	log = log4javascript.getLogger();
			var cookieName = "log4javascriptsessionid";
			var sessionId;
			
			function trim(str) {
				return str.replace(/^\s+/, "").replace(/\s+$/, "");
			}
			
			window.onload = function() {
				// Attempt to retrieve session id from a cookie
				if (document.cookie) {
					var cookieBits = document.cookie.split(";");
					for (var i = 0; i < cookieBits.length; i++) {
						var nameValueBits = cookieBits[i].split("=");
						if (trim(nameValueBits[0]) == cookieName) {
							sessionId = trim(nameValueBits[1]);
							refreshServerLog();
						}
					}
				}
			}
			
			var serverLogTimer;

			function requestCallback(xmlHttp) {
				if (!sessionId) {
					// A new session has been started. Now we send the sessionid in each
					// subsequent Ajax reqest for the benefit of IE5 as well as storing
					// the session id in a cookie
					sessionId = xmlHttp.responseText;
					ajaxAppender.getLayout().setCustomField(cookieName, xmlHttp.responseText);
					document.cookie = cookieName + "=" + sessionId;
					refreshServerLog();
				}
				if (serverLogTimer) {
					clearTimeout(serverLogTimer);
				}
				serverLogTimer = setTimeout(refreshServerLog, "1000");
			}
			
			function refreshServerLog() {
				var logFile = "ajax/sessions/" + sessionId + ".txt" + "?" + (new Date()).getTime();
				var iframe = document.getElementById("serverLogIFrame");
				iframe.src = logFile;
				serverLogTimer = null;
			}
			
			var ajaxAppender = new log4javascript.AjaxAppender("ajax/sessionlogger.php");
			ajaxAppender.setWaitForResponse(true);
			ajaxAppender.setRequestSuccessCallback(requestCallback);
			log.addAppender(ajaxAppender);
		
			var words = ["Watford", "booked", "their", "place", "in", "the", "Premiership",
				"with", "a", "convincing", "victory", "over", "Leeds", "in", "a", "frantic",
				"play-off", "final", "The", "Hornets", "went", "in", "front", "through",
				"Jay", "DeMerit", "powerful", "header", "from", "five", "yards", "after",
				"Ashley", "Young", "corner", "Aidy", "Boothroyd", "side", "were", "two",
				"up", "when", "James", "Chambers", "shot", "deflected", "off", "Eddie",
				"Lewis", "and", "looped", "on", "to", "the", "post", "before", "dropping",
				"in", "off", "Neil", "Sullivan", "Darius", "Henderson", "completed", "the",
				"rout", "with", "a", "cool", "penalty", "after", "Shaun", "Derry",
				"cynically", "felled", "Marlon", "King"];
			
			var loaded = false;
			
			function generateRandom() {
				var numberOfEntries = parseInt(document.getElementById("numberOfLogEntries").value);
				for (var i = 0; i < numberOfEntries; i++) {
					var numberOfWords = 1 + Math.floor(10 * Math.random());
					var entryWords = [];
					for (var j = 0; j < numberOfWords; j++) {
						entryWords.push(words[Math.floor(Math.random() * words.length)]);
					}
					var entryMessage = entryWords.join(" ");
					var levelNum = Math.floor(Math.random() * 6);
					switch (levelNum) {
						case 0:
							log.trace(entryMessage);
							break;
						case 1:
							log.debug(entryMessage);
							break;
						case 2:
							log.info(entryMessage);
							break;
						case 3:
							log.warn(entryMessage);
							break;
						case 4:
							log.error(entryMessage);
							break;
						case 5:
							log.fatal(entryMessage);
							break;
					}
				}
			}
			// ]]>
		</script>
	</head>
	<body>
		<div id="container" class="nonav">
			<div id="header">
				<h1><a href="../docs/index.html">log4javascript</a></h1>
			</div>
			<div id="content">
				<div id="nav">
					<a class="navitem" href="../docs/index.html">docs</a>
					| <a class="navitem" href="../docs/quickstart.html">quick start</a>
					| <a class="navitem" href="../docs/manual.html">manual</a>
					| <span class="navitem">demo</span>
					| <a class="navitem" href="http://www.timdown.co.uk/log4javascript" target="_blank">website</a>
				</div>
				<h1>log4javascript Ajax example</h1>
				<p>
					Enter a log message below and click on one of the buttons to log
					your message at your desired level, or use the "Generate random log entries" option
				</p>
				<div class="example">
					<h2>Logging</h2>
					<input type="checkbox" id="enabled" onclick="log4javascript.setEnabled(this.checked)" checked="checked" /> <label for="enabled">logging enabled</label>
					<br />
					<input type="text" id="logText" value="Put log message here" />
					<input type="button" value="trace" onclick="log.trace(document.getElementById('logText').value)" />
					<input type="button" value="debug" onclick="log.debug(document.getElementById('logText').value)" />
					<input type="button" value="info" onclick="log.info(document.getElementById('logText').value)" />
					<input type="button" value="warn" onclick="log.warn(document.getElementById('logText').value)" />
					<input type="button" value="error" onclick="log.error(document.getElementById('logText').value)" />
					<input type="button" value="fatal" onclick="log.fatal(document.getElementById('logText').value)" />
					<br />
					Generate <input type="text" size="5" id="numberOfLogEntries" value="50" /> random log entries
					<input type="button" value="go" onclick="generateRandom()" />
				</div>
				<h2>Server session log</h2>
				<div class="serverlog">
					<iframe id="serverLogIFrame" src="blank.html" width="100%" height="100%" frameborder="1"></iframe>
				</div>
			</div>
			<br class="clear" />
			<div id="footer">
				<span class="externallinkinfo">
					<strong>NB.</strong> All external links open in a new window.
				</span>
				Written by Tim Down. <a href="mailto:tim@timdown.co.uk">tim@timdown.co.uk</a>
				<br />
				log4javascript is distributed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html"
					title="Apache License, Version 2.0 (opens in new window)" target="_blank">Apache License,
					Version 2.0</a>
			</div>
		</div>
	</body>
</html>
